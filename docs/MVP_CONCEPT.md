# Концепция MVP проекта "Рикошет"

## Обзор

MVP (Minimum Viable Product) проекта "Рикошет" представляет собой простую, но функциональную реализацию системы оркестрации языковых моделей для обработки больших объемов текстовой информации. Основная цель MVP — проверить ключевые гипотезы проекта и предоставить базовую функциональность, которая может быть быстро оценена пользователями.

## Ключевые гипотезы для проверки

1. **Гипотеза о преодолении ограничений контекста**: Цепочки специализированных моделей могут эффективно обрабатывать объемы данных, значительно превышающие контекстное окно отдельных моделей.

2. **Гипотеза о ролевой специализации**: Назначение различных ролей моделям (анализатор, суммаризатор и т.д.) повышает качество обработки информации.

3. **Гипотеза о сохранении контекста**: Промежуточные чекпоинты позволяют эффективно передавать контекст между этапами обработки.

4. **Гипотеза о практической ценности**: Функциональность "Рикошет" решает реальные проблемы пользователей при работе с большими объемами информации.
Техническое задание на разработку децентрализованной платформы RICOSHET Network
Название проекта:
Ricoshet Network
1. Цель проекта
Создать децентрализованную платформу, объединяющую возможности Taskmaster AI с системой совместного использования API-ключей от нейросетей. Платформа позволит пользователям делиться своими API-ключами (например, от OpenAI, Anthropic, Google AI), предоставлять доступ к ним за небольшую плату обычным пользователям, а владельцам ключей получать доход от их использования. Проект будет расширяемым, с поддержкой интеграции различных нейросетей и платформ.
2. Описание продукта
Ricoshet Network — это open-source платформа для управления задачами с использованием искусственного интеллекта. Она сочетает функционал Taskmaster AI (управление задачами, их распределение и логирование) с децентрализованной моделью монетизации API-ключей. Пользователи с премиум-подписками на нейросети могут регистрировать свои ключи, а обычные пользователи получают доступ к этим ресурсам за 5-10 долларов в месяц. Платформа распределяет запросы между ключами, обеспечивает выполнение задач и делит доход между владельцами ключей и системой.
3. Основные функции
Регистрация и управление API-ключами
Пользователи добавляют свои API-ключи через команду add-key.
Безопасное хранение ключей с использованием шифрования (например, AES-256).
Статистика использования ключей и дохода для владельцев через CLI или дашборд.
Управление задачами
Создание задач через команды CLI: add-task, edit-task, delete-task.
Автоматическая разбивка задач на подзадачи с оценкой сложности (analyze-complexity).
Распределение задач между AI-агентами с использованием доступных API-ключей.
Распределение запросов
Алгоритм балансировки нагрузки (например, Round-Robin) для распределения запросов между ключами.
Учет лимитов API и текущей нагрузки на ключи.
Логирование и мониторинг
Логирование всех запросов и выполнения задач в JSON или TXT-файлах.
Отображение прогресса задач через CLI или текстовые отчеты.
Экспорт логов в CSV или Markdown для анализа.
Монетизация
Подписка для обычных пользователей: 5-10 долларов в месяц.
Владельцы ключей получают 70% дохода от использования их ключей, платформа берет 30% комиссии.
Статистика доходов и автоматические выплаты через Stripe или PayPal.
Интеграции
Поддержка нейросетей: OpenAI, Anthropic, Google AI, Mistral, локальные модели (Ollama).
Интеграция с редакторами кода (VS Code, Cursor) через протокол MCP.
Подключение к GitHub/GitLab для создания Issues или PR на основе задач.
4. Технические требования
Язык разработки:
Сервер: Go или Rust (производительность, безопасность).
CLI: Python (удобство интеграции с AI).
Фреймворки и библиотеки:
CLI: Click (Python) или Cobra (Go).
API: requests (Python), net/http (Go).
База данных: PostgreSQL или MongoDB.
Шифрование: AES-256 для ключей.
Кроссплатформенность: Windows, macOS, Linux.
Установка: Через pip (Python) или как бинарный файл (Go/Rust).
5. Архитектура системы
Сервер:
Управление пулом ключей, распределение запросов, мониторинг лимитов.
Хранение данных пользователей и ключей.
Клиент (CLI):
Отправка задач на сервер.
Управление ключами и просмотр статистики.
База данных:
Хранение информации о пользователях, ключах, задачах и запросах.
6. Монетизация и бизнес-модель
Подписка: 5-10 долларов для доступа к API-ключам.
Доход владельцев ключей: 70% от использования их ключей.
Комиссия платформы: 30%.
Выплаты: Ежемесячно через Stripe/PayPal.
Прозрачность: Дашборд с данными о запросах и доходах.
7. Юридические аспекты
Изучение TOS провайдеров API (OpenAI, Anthropic и др.) для соблюдения правил совместного использования ключей.
Возможные партнерства с провайдерами для легализации модели.
Защита данных пользователей и ключей в соответствии с GDPR и другими стандартами.
8. Варианты развития
Полная децентрализация: Использование блокчейна для управления ключами и выплатами.
Расширение нейросетей: Добавление новых моделей и локальных решений.
Веб-интерфейс: Управление задачами и ключами через браузер.
Облачная интеграция: Хранение логов и данных в облаке (AWS, Google Cloud).

## Архитектура MVP

Для MVP предлагается следующая архитектура:

```
┌───────────────────────────────────────────────────────────────┐
│                    Пользовательский интерфейс                  │
│                                                               │
│  ┌────────────────────┐  ┌────────────────────┐               │
│  │ Конструктор цепочек │  │ Мониторинг         │               │
│  └────────────────────┘  └────────────────────┘               │
└───────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌───────────────────────────────────────────────────────────────┐
│                      API Gateway                               │
└───────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌───────────────────────────────────────────────────────────────┐
│                  Монолитный оркестратор                        │
│                                                               │
│  ┌────────────────────┐  ┌────────────────────┐               │
│  │ Управление цепочками│  │ Сегментация        │               │
│  └────────────────────┘  └────────────────────┘               │
│                                                               │
│  ┌────────────────────┐  ┌────────────────────┐               │
│  │ Управление чекпоинтами│  │ Маршрутизация     │               │
│  └────────────────────┘  └────────────────────┘               │
└───────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌───────────────────────────────────────────────────────────────┐
│                     Сервисы моделей                            │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐   │
│  │ OpenAI Сервис   │  │ Claude Сервис  │  │ DeepSeek Сервис│   │
│  └────────────────┘  └────────────────┘  └────────────────┘   │
└───────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌───────────────────────────────────────────────────────────────┐
│                   Хранилище данных                             │
│  ┌────────────────────┐  ┌────────────────────┐               │
│  │ PostgreSQL         │  │ MinIO              │               │
│  │ (метаданные)       │  │ (чекпоинты)        │               │
│  └────────────────────┘  └────────────────────┘               │
└───────────────────────────────────────────────────────────────┘
```

## Механизм интерактивного выбора моделей

Одним из ключевых компонентов MVP является интерактивный механизм выбора моделей, вдохновленный проектом Task Master. Этот механизм позволяет пользователям гибко настраивать модели для различных ролей в цепочках обработки.

### Архитектура механизма выбора моделей

```
┌───────────────────────────────────────────┐
│         Интерфейс выбора моделей          │
│                                           │
│  ┌─────────────┐  ┌────────────────────┐  │
│  │ CLI-интерфейс│  │ MCP-интерфейс      │  │
│  └─────────────┘  └────────────────────┘  │
└─────────────────────────┬─────────────────┘
                          │
                          ▼
┌───────────────────────────────────────────┐
│        Хранилище настроек моделей         │
│                                           │
│  ┌───────────────────────────────────┐    │
│  │ Конфигурация (.ricochet/models.json)   │
│  └───────────────────────────────────┘    │
└─────────────────────────┬─────────────────┘
                          │
                          ▼
┌───────────────────────────────────────────┐
│      Система управления API-ключами       │
│                                           │
│  ┌─────────────┐  ┌────────────────────┐  │
│  │ Локальные    │  │ Общие ключи        │  │
│  │ ключи        │  │                    │  │
│  └─────────────┘  └────────────────────┘  │
└───────────────────────────────────────────┘
```

### Функциональность в MVP

В рамках MVP будет реализована следующая функциональность:

1. **Интерактивный CLI-интерфейс**:
   - Команда `ricochet models setup` для запуска интерактивного процесса выбора моделей
   - Использование библиотеки `survey` для создания интерактивных меню в терминале
   - Поддержка выбора моделей для основных ролей (основная, исследовательская, резервная)
   - Поддержка выбора моделей для специализированных ролей в цепочках (анализатор, суммаризатор, интегратор)

2. **Хранение настроек**:
   - Сохранение настроек моделей в файле `.ricochet/models.json`
   - Структура файла, совместимая с форматом Task Master для обеспечения возможности обмена настройками
   - Автоматическая загрузка настроек при запуске приложения

3. **Интеграция с цепочками моделей**:
   - Автоматический выбор моделей по ролям при создании новой цепочки
   - Возможность переопределения модели при добавлении в цепочку
   - Приоритет пользовательского выбора над настройками по умолчанию

4. **Интеграция с MCP**:
   - MCP-команда `models_setup` для запуска интерактивного процесса выбора моделей из редактора кода
   - Отображение текущих настроек моделей в редакторе через MCP-команду `show_models`

### Пример использования

```bash
$ ricochet models setup
? Выберите основную модель для генерации:
> anthropic / claude-3-sonnet
  openai / gpt-4-turbo
  deepseek / deepseek-coder
  mistral / mistral-large

? Выберите модель для роли "Анализатор":
> anthropic / claude-3-opus
  openai / gpt-4-turbo
  openai / gpt-4o

# ... другие роли ...

✅ Настройка моделей завершена!

$ ricochet chain create --name "Анализ документа"
# Система автоматически предложит модели, соответствующие ролям
```

## Система управления задачами и их мониторинг

Важным компонентом MVP является система управления задачами, адаптированная из проекта Task Master. Эта система позволяет эффективно организовать процесс выполнения цепочек моделей и обеспечить детальный мониторинг их выполнения.

### Структура задачи

В MVP задача представляет собой базовую единицу работы, выполняемую моделью в рамках цепочки. Каждая задача имеет следующую структуру:

```json
{
  "id": "task-123",
  "type": "model_execution",
  "title": "Анализ структуры документа",
  "description": "Анализ структуры входного документа с выделением ключевых тем",
  "status": "completed",
  "dependencies": ["task-122"],
  "model": {
    "provider": "openai",
    "name": "gpt-4",
    "role": "analyzer",
    "parameters": {
      "temperature": 0.3,
      "max_tokens": 2000
    }
  },
  "input": {
    "type": "text",
    "source": "checkpoint-122",
    "segment": 1
  },
  "output": {
    "type": "text",
    "destination": "checkpoint-123"
  },
  "metrics": {
    "tokens_input": 1456,
    "tokens_output": 834,
    "duration_ms": 2300,
    "cost": 0.032
  },
  "created_at": "2023-06-01T10:15:30Z",
  "started_at": "2023-06-01T10:15:31Z",
  "completed_at": "2023-06-01T10:15:33Z"
}
```

### Система статусов задач

Задачи могут находиться в следующих статусах:
- **pending**: Задача создана, но не может быть запущена из-за невыполненных зависимостей
- **ready**: Задача готова к выполнению, все зависимости удовлетворены
- **running**: Задача в процессе выполнения
- **completed**: Задача успешно завершена
- **failed**: Задача завершилась с ошибкой
- **paused**: Выполнение задачи временно приостановлено
- **cancelled**: Задача отменена пользователем

### Мониторинг выполнения задач

Система мониторинга в MVP предоставляет следующие возможности:

1. **CLI-интерфейс для мониторинга**:
   ```
   $ ricochet monitor task-123
   
   Задача #123: Анализ структуры документа
   ┌───────────────────────────────────────────────────┐
   │ Статус: ✅ Завершена                              │
   │ Модель: OpenAI GPT-4 (Анализатор)                 │
   │ Прогресс: [▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓] 100%       │
   │ Время: 2.3с / 2.3с                                │
   │ Токены: 1456 вход / 834 выход                     │
   │ Стоимость: $0.032                                 │
   └───────────────────────────────────────────────────┘
   ```

2. **Логирование событий** в структурированном формате для последующего анализа
3. **Оповещения** о завершении задач или возникновении ошибок
4. **Сохранение метрик** для анализа производительности моделей

## Интеграция с редакторами через MCP

MVP включает базовую интеграцию с редакторами кода (Cursor, VS Code) через протокол MCP (Model Control Protocol), адаптированный из проекта Task Master. Это позволяет использовать функциональность Ricochet непосредственно из редактора кода.

### Настройка MCP

Настройка MCP для Ricochet выполняется путем добавления конфигурации в файл `~/.cursor/mcp.json` или аналогичный файл для других редакторов:

```json
{
  "mcpServers": {
    "ricochet": {
      "command": "ricochet-task",
      "args": ["mcp"],
      "env": {
        "RICOCHET_API_KEY": "YOUR_API_KEY_HERE"
      }
    }
  }
}
```

### Основные MCP-команды в MVP

В рамках MVP реализованы следующие MCP-команды:

1. **Базовые команды**:
   - `ricochet_init`: Инициализация проекта Ricochet
   - `ricochet_status`: Проверка статуса компонентов

2. **Управление цепочками**:
   - `chain_list`: Просмотр доступных цепочек
   - `chain_run`: Запуск цепочки моделей
   - `chain_status`: Проверка статуса выполнения цепочки

3. **Управление моделями**:
   - `models_setup`: Интерактивный выбор моделей
   - `models_list`: Просмотр настроенных моделей

4. **Мониторинг**:
   - `monitor_chain`: Мониторинг выполнения цепочки
   - `monitor_task`: Мониторинг выполнения конкретной задачи

### Взаимодействие через чат в редакторе

Пользователь может взаимодействовать с Ricochet через чат в редакторе кода:

```
Пользователь: Запусти цепочку "Анализ документа" для файла report.txt

Ассистент: Запускаю цепочку "Анализ документа" для файла report.txt...

Цепочка запущена! ID: chain-456
Отслеживаю прогресс:

[▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓----------] 65%
Выполняется: Суммаризация темы A (Задача #124)
Осталось примерно: 45 секунд

Вы можете продолжить работу, я сообщу о завершении цепочки.
```

## Пример сценария использования в MVP

1. **Загрузка данных**: Пользователь загружает большой текстовый документ (например, 50k токенов)
2. **Создание цепочки**: Пользователь создает линейную цепочку из трех моделей:
   - Модель 1 (GPT-4) - Роль: "Анализатор" - Задача: разбить текст на ключевые темы
   - Модель 2 (Claude) - Роль: "Суммаризатор" - Задача: создать краткое резюме по каждой теме
   - Модель 3 (DeepSeek) - Роль: "Интегратор" - Задача: объединить резюме в целостный обзор
3. **Выполнение цепочки**: Система запускает последовательную обработку
4. **Мониторинг**: Пользователь наблюдает за прогрессом выполнения и может просматривать промежуточные чекпоинты
5. **Результат**: Пользователь получает финальный результат и может оценить качество

## Метрики успеха MVP

1. **Технические метрики**:
   - Успешная обработка документов объемом до 100k токенов
   - Время выполнения полной цепочки не более 5 минут для документа 50k токенов
   - Стабильность системы (не более 5% сбоев)

2. **Пользовательские метрики**:
   - Не менее 70% пользователей считают результаты полезными
   - Не менее 60% пользователей хотят продолжить использование
   - NPS (Net Promoter Score) выше 30

## Ограничения MVP

- Только текстовые данные
- Только линейные цепочки
- Ограниченный набор ролей (3-4)
- Простой алгоритм сегментации
- Без оптимизации производительности
- Монолитная архитектура
- Ограниченная интеграция (2-3 модели)

## Следующие шаги после MVP

После успешного тестирования MVP планируется:

1. Расширение поддерживаемых типов цепочек (параллельные, иерархические)
2. Улучшение алгоритмов сегментации
3. Расширение библиотеки ролей и шаблонов
4. Переход к микросервисной архитектуре
5. Улучшение UI для конструирования сложных цепочек
6. Аналитический модуль для оценки эффективности 

вдохновение - https://github.com/eyaltoledano/claude-task-master