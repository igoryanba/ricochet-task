# План реализации MVP проекта "Рикошет"

Этот документ содержит детальный технический план по разработке MVP платформы "Рикошет". План разбит на модули и конкретные задачи, что позволяет вести разработку итеративно, с учетом вдохновения от проекта claude-task-master.

**Технологический стек MVP:**
*   **Бэкенд:** Go
*   **CLI-клиент:** Go (изменено с Python + Typer/Click)
*   **База данных:** PostgreSQL
*   **Хранилище артефактов:** MinIO (или локальная файловая система для упрощения)
*   **Протокол интеграции:** MCP (Model Control Protocol) для встраивания в IDE

---

## Модуль 1: Настройка проекта и окружения

**Цель:** Подготовить основу для разработки, настроить репозиторий и CI/CD.

*   [x] **Задача 1.1:** Создать репозиторий для CLI-инструмента Ricochet Task на Go.
    * Создана базовая структура проекта с директориями: cmd, pkg, internal, tests, docs
    * Реализованы базовые структуры данных для работы с API-ключами, цепочками моделей и чекпоинтами
    * Реализована базовая структура конфигурации
*   [x] **Задача 1.2:** Определить структуру команд CLI-инструмента.
    * Определены основные команды: ricochet init, key, chain, checkpoint
    * Подготовлена структура для расширения командами в будущем
*   [x] **Задача 1.3:** Разработать схему API для взаимодействия с API Gateway.
    * Создан базовый API-клиент для взаимодействия с API Gateway
    * Определены основные эндпоинты для работы с моделями и чатом
*   [x] **Задача 1.4:** Создать документацию по интеграции Ricochet Task с существующей архитектурой.
    * Создан документ с описанием взаимодействия с компонентами системы
    * Описана архитектура взаимодействия CLI с API Gateway, Model Services, Data Service
*   [ ] **Задача 1.5:** Настроить CI/CD для автоматической сборки, тестирования и релиза.

## Модуль 2: Ядро оркестратора

**Цель:** Реализовать основные компоненты ядра системы.

*   [x] **Задача 2.1:** Разработать основные интерфейсы и структуры данных для оркестратора.
    * Созданы основные интерфейсы оркестратора
    * Определены структуры данных для моделей, чекпоинтов и цепочек
    * Реализована базовая архитектура оркестрации
*   [x] **Задача 2.2:** Разработать систему для создания, сохранения и загрузки цепочек обработки.
    * Реализовано хранилище цепочек в файловой системе
    * Созданы методы для создания, получения и обновления цепочек
    * Реализована сериализация/десериализация цепочек в JSON
*   [x] **Задача 2.3:** Реализовать механизм сегментации текста для обработки больших документов.
    * Реализован базовый алгоритм сегментации по размеру контекста
    * Добавлена поддержка параметризации размера сегментов
    * Реализован механизм объединения обработанных сегментов
*   [x] **Задача 2.4:** Адаптировать систему задач Task Master для представления моделей в цепочке обработки:
    *   [x] **Задача 2.4.1:** Расширить формат JSON для задач с полями специфичными для моделей AI.
    *   [x] **Задача 2.4.2:** Добавить поля для входных и выходных данных моделей.
    *   [x] **Задача 2.4.3:** Добавить поля для настройки параметров моделей.
*   [x] **Задача 2.5:** Разработать систему чекпоинтов для сохранения промежуточных результатов:
    *   [x] **Задача 2.5.1:** Реализовать интерфейс хранения чекпоинтов.
    *   [x] **Задача 2.5.2:** Реализовать сохранение чекпоинтов в файловой системе.
    *   [ ] **Задача 2.5.3:** Реализовать сохранение чекпоинтов в MinIO.
*   [x] **Задача 2.6:** Реализовать механизмы валидации и обработки ошибок.
    * Добавлена валидация параметров моделей и цепочек
    * Реализована система обработки и логирования ошибок
    * Добавлены проверки на соответствие типов и ролей моделей

## Модуль 3: Интеграция с моделями

**Цель:** Обеспечить взаимодействие с различными языковыми моделями.

*   [x] **Задача 3.1:** Реализовать базовый интерфейс для взаимодействия с моделями.
    * Создан универсальный интерфейс для всех моделей
    * Определены общие методы и параметры
    * Реализована система типов для моделей
*   [x] **Задача 3.2:** Разработать адаптер для API OpenAI (модели GPT-3.5, GPT-4).
    * Реализован адаптер для API OpenAI
    * Добавлена поддержка основных параметров запросов
    * Реализована обработка ответов и ошибок
*   [x] **Задача 3.3:** Разработать адаптер для API Anthropic (модели Claude).
    * Создан адаптер для API Anthropic
    * Добавлена поддержка моделей Claude 3 (Haiku, Sonnet, Opus)
    * Реализована обработка специфичных для Claude параметров
*   [x] **Задача 3.4:** Разработать адаптер для API DeepSeek.
    * Создан базовый адаптер для API DeepSeek
    * Подготовлена структура для расширения функциональности
*   [x] **Задача 3.5:** Реализовать систему управления API-ключами:
    *   [x] **Задача 3.5.1:** Адаптация системы управления ключами из Task Master.
        * Адаптирована структура ключей из Task Master
        * Реализованы команды для управления ключами
    *   [x] **Задача 3.5.2:** Реализация шифрования ключей для безопасного хранения.
        * Добавлена базовая система шифрования ключей
        * Реализовано хранение зашифрованных ключей в файловой системе
    *   [x] **Задача 3.5.3:** Реализация механизма для совместного использования ключей.
        * Добавлен флаг shared для ключей
        * Реализована система разделения доступа к ключам
*   [x] **Задача 3.6:** Реализовать механизм маршрутизации запросов между различными моделями.
    * Создан маршрутизатор запросов на основе типа модели
    * Реализована логика выбора подходящего адаптера
    * Добавлена обработка ошибок и fallback механизмы
*   [x] **Задача 3.7:** Разработать систему ограничения запросов (rate limiting) для соблюдения лимитов API.
    * Реализован базовый механизм ограничения запросов
    * Добавлен учет использования токенов
    * Реализованы задержки для предотвращения превышения лимитов
*   [ ] **Задача 3.8:** Реализовать интерактивный выбор моделей для цепочек:
    *   [x] **Задача 3.8.1:** Создать механизм получения списка доступных моделей от провайдеров.
    *   [ ] **Задача 3.8.2:** Реализовать интерфейс для выбора моделей под различные роли (по аналогии с Task Master).
    *   [ ] **Задача 3.8.3:** Создать механизм сохранения и загрузки настроек выбора моделей.
    *   [ ] **Задача 3.8.4:** Реализовать систему ролей для моделей (основная, исследовательская, резервная).
*   [ ] **Задача 3.9:** Интегрировать систему настройки моделей с Task Master:
    *   [ ] **Задача 3.9.1:** Адаптировать интерфейс настройки моделей из Task Master.
    *   [ ] **Задача 3.9.2:** Реализовать возможность переиспользования конфигурации моделей Task Master.
    *   [ ] **Задача 3.9.3:** Обеспечить совместимость форматов хранения настроек.
*   [ ] **Задача 3.10:** Адаптировать структуру задач из Task Master:
    *   [ ] **Задача 3.10.1:** Создать модели данных для представления задач и их зависимостей.
    *   [ ] **Задача 3.10.2:** Реализовать механизмы преобразования между задачами Task Master и цепочками Ricochet.
    *   [ ] **Задача 3.10.3:** Добавить метаданные для отслеживания статуса выполнения задач.
    *   [ ] **Задача 3.10.4:** Разработать механизмы для контроля зависимостей между задачами.

## Модуль 4: CLI-клиент

**Цель:** Создать удобный интерфейс командной строки для работы с системой.

*   [x] **Задача 4.1:** Разработать основную структуру CLI на Go с использованием Cobra.
    * Создана основная структура CLI с использованием Cobra
    * Реализованы корневые команды и настройка CLI
    * Добавлена система обработки флагов и аргументов
*   [x] **Задача 4.2:** Реализовать команды для управления цепочками:
    *   [x] **Задача 4.2.1:** `chain create` - создание новой цепочки.
    *   [x] **Задача 4.2.2:** `chain list` - просмотр доступных цепочек.
    *   [x] **Задача 4.2.3:** `chain run` - запуск цепочки.
    *   [x] **Задача 4.2.4:** `chain add-model` - добавление модели в цепочку.
*   [x] **Задача 4.3:** Реализовать команды для управления чекпоинтами:
    *   [x] **Задача 4.3.1:** `checkpoint list` - список доступных чекпоинтов.
    *   [x] **Задача 4.3.2:** `checkpoint get` - получение содержимого чекпоинта.
    *   [x] **Задача 4.3.3:** `checkpoint delete` - удаление чекпоинта.
*   [x] **Задача 4.4:** Реализовать команды для управления API-ключами:
    *   [x] **Задача 4.4.1:** `key add` - добавление API-ключа.
    *   [x] **Задача 4.4.2:** `key list` - список доступных ключей.
    *   [x] **Задача 4.4.3:** `key delete` - удаление ключа.
    *   [x] **Задача 4.4.4:** `key share` - публикация ключа для общего доступа.
*   [ ] **Задача 4.5:** Реализовать команды для мониторинга:
    *   [ ] **Задача 4.5.1:** `monitor chain` - мониторинг выполнения цепочки.
    *   [ ] **Задача 4.5.2:** `monitor usage` - мониторинг использования API-ключей.
*   [ ] **Задача 4.6:** Реализовать интерактивное создание цепочек с подсказками.
*   [ ] **Задача 4.7:** Интегрировать CLI с системой управления задачами Task Master для контроля процесса разработки.
*   [ ] **Задача 4.8:** Реализовать команду для интерактивной настройки моделей:
    *   [ ] **Задача 4.8.1:** `models setup` - интерактивный выбор моделей для различных ролей.
    *   [ ] **Задача 4.8.2:** `models list` - отображение настроенных моделей и их ролей.
    *   [ ] **Задача 4.8.3:** `models reset` - сброс настроек моделей к значениям по умолчанию.
*   [x] **Задача 4.9:** Реализовать алиасы для shell (`rt` вместо `ricochet-task`).

## Модуль 5: Интеграция с MCP

**Цель:** Обеспечить интеграцию с редакторами кода через протокол MCP.

*   [x] **Задача 5.1:** Изучить и адаптировать MCP-сервер из проекта Task Master.
*   [ ] **Задача 5.2:** Реализовать MCP-хендлеры для основных операций:
    *   [x] **Задача 5.2.1:** Просмотр и управление цепочками.
    *   [ ] **Задача 5.2.2:** Запуск и мониторинг выполнения.
    *   [ ] **Задача 5.2.3:** Просмотр чекпоинтов и результатов.
*   [ ] **Задача 5.3:** Разработать визуальное представление цепочек в редакторе кода.
*   [ ] **Задача 5.4:** Реализовать интерактивное конструирование цепочек в редакторе.
*   [ ] **Задача 5.5:** Интегрировать механизм подсказок от AI при работе над задачами в редакторе.
*   [ ] **Задача 5.6:** Реализовать MCP-команды для управления моделями:
    *   [x] **Задача 5.6.1:** `models_setup` - интерактивный выбор моделей через интерфейс редактора.
    *   [ ] **Задача 5.6.2:** `show_models` - отображение настроенных моделей в редакторе.
    *   [ ] **Задача 5.6.3:** `select_model_for_role` - выбор конкретной модели для определенной роли.
*   [ ] **Задача 5.7:** Реализовать интерактивный режим инициализации:
    *   [ ] **Задача 5.7.1:** Создание конфигурационных файлов для MCP.
    *   [ ] **Задача 5.7.2:** Настройка интеграции с редакторами кода.
    *   [ ] **Задача 5.7.3:** Автоматическое добавление shell алиасов.
*   [ ] **Задача 5.8:** Разработать MCP-команды для работы с задачами:
    *   [ ] **Задача 5.8.1:** `tasks_list` - отображение списка активных задач.
    *   [ ] **Задача 5.8.2:** `task_details` - просмотр деталей задачи.
    *   [ ] **Задача 5.8.3:** `task_status` - отслеживание статуса выполнения задачи.
    *   [ ] **Задача 5.8.4:** `task_create` - создание новой задачи через редактор.
*   [ ] **Задача 5.9:** Создать механизм визуализации прогресса выполнения:
    *   [ ] **Задача 5.9.1:** Интерактивные прогресс-бары для задач в редакторе.
    *   [ ] **Задача 5.9.2:** Отображение промежуточных результатов.
    *   [ ] **Задача 5.9.3:** Система уведомлений о завершении задач.

## Модуль 6: База данных и хранение

**Цель:** Реализовать персистентное хранение данных системы.

*   [ ] **Задача 6.1:** Спроектировать схему базы данных PostgreSQL:
    *   [ ] **Задача 6.1.1:** Таблицы для цепочек и их конфигурации.
    *   [ ] **Задача 6.1.2:** Таблицы для API-ключей и учёта их использования.
    *   [ ] **Задача 6.1.3:** Таблицы для метаданных чекпоинтов.
    *   [ ] **Задача 6.1.4:** Таблицы для пользователей и их настроек.
*   [ ] **Задача 6.2:** Реализовать ORM-слой для работы с базой данных.
*   [ ] **Задача 6.3:** Настроить миграции для базы данных.
*   [ ] **Задача 6.4:** Реализовать интеграцию с MinIO для хранения артефактов:
    *   [ ] **Задача 6.4.1:** Хранение чекпоинтов.
    *   [ ] **Задача 6.4.2:** Хранение логов выполнения.
    *   [ ] **Задача 6.4.3:** Хранение пользовательских данных.
*   [ ] **Задача 6.5:** Реализовать механизмы кэширования для повышения производительности.

## Модуль 7: Безопасность и администрирование

**Цель:** Обеспечить безопасность системы и возможности администрирования.

*   [x] **Задача 7.1:** Реализовать механизмы аутентификации и авторизации.
    * Добавлена базовая система аутентификации
    * Реализовано хранение учетных данных
*   [x] **Задача 7.2:** Внедрить механизм шифрования API-ключей и чувствительных данных.
    * Реализовано шифрование API-ключей
    * Добавлена защита чувствительных данных в конфигурации
*   [ ] **Задача 7.3:** Разработать систему логирования для аудита безопасности.
*   [ ] **Задача 7.4:** Реализовать инструменты для администрирования системы:
    *   [ ] **Задача 7.4.1:** Управление пользователями.
    *   [ ] **Задача 7.4.2:** Мониторинг использования ресурсов.
    *   [ ] **Задача 7.4.3:** Настройка параметров системы.
*   [ ] **Задача 7.5:** Разработать механизмы ограничения доступа к API-ключам.

## Модуль 8: Тестирование и документация

**Цель:** Обеспечить качество кода и документировать систему.

*   [x] **Задача 8.1:** Разработать набор модульных тестов для ключевых компонентов.
    * Добавлены базовые тесты для основных компонентов
    * Реализована инфраструктура для тестирования
*   [ ] **Задача 8.2:** Разработать интеграционные тесты для проверки взаимодействия компонентов.
*   [ ] **Задача 8.3:** Провести нагрузочное тестирование для проверки производительности.
*   [x] **Задача 8.4:** Создать подробную документацию для пользователей:
    *   [x] **Задача 8.4.1:** Руководство по установке и настройке.
        * Создана базовая документация по установке
        * Добавлены инструкции по настройке окружения
    *   [x] **Задача 8.4.2:** Руководство по использованию CLI.
        * Создана документация по основным командам CLI
        * Добавлены примеры использования
    *   [ ] **Задача 8.4.3:** Руководство по интеграции с редакторами кода.
    *   [ ] **Задача 8.4.4:** Примеры использования для типичных сценариев.
*   [x] **Задача 8.5:** Создать документацию для разработчиков:
    *   [x] **Задача 8.5.1:** Архитектура системы.
        * Создана документация по общей архитектуре системы
        * Описаны основные компоненты и их взаимодействие
    *   [x] **Задача 8.5.2:** API-документация.
        * Документированы основные интерфейсы API
        * Добавлено описание параметров и возвращаемых значений
    *   [ ] **Задача 8.5.3:** Руководство по внесению изменений.

## Модуль 9: Требования к установке и запуску

**Цель:** Определить и документировать требования для установки и запуска системы.

*   [x] **Задача 9.1:** Определить системные требования:
    *   [x] **Задача 9.1.1:** Минимальные требования к оборудованию (CPU, RAM, дисковое пространство).
    *   [x] **Задача 9.1.2:** Требования к программному обеспечению (OS, Docker, Python, Go и др.).
    *   [x] **Задача 9.1.3:** Требования к сетевому подключению.

*   [x] **Задача 9.2:** Подготовить руководство по установке:
    *   [x] **Задача 9.2.1:** Установка через pip (CLI).
    *   [ ] **Задача 9.2.2:** Установка с использованием Docker.
    *   [x] **Задача 9.2.3:** Установка из исходного кода.

*   [x] **Задача 9.3:** Подготовить инструкции по настройке API-ключей:
    *   [x] **Задача 9.3.1:** Получение ключей от различных провайдеров (OpenAI, Anthropic и др.).
    *   [x] **Задача 9.3.2:** Безопасное хранение и использование ключей.
    *   [x] **Задача 9.3.3:** Настройка доступа к общим ключам.

*   [ ] **Задача 9.4:** Подготовить руководство по настройке MCP для интеграции с редакторами кода:
    *   [ ] **Задача 9.4.1:** Настройка MCP для Cursor.
    *   [ ] **Задача 9.4.2:** Настройка MCP для VS Code.
    *   [ ] **Задача 9.4.3:** Настройка MCP для других редакторов (Windsurf, Lovable и др.).

*   [x] **Задача 9.5:** Подготовить инструкции по инициализации системы:
    *   [x] **Задача 9.5.1:** Инициализация проекта (`ricochet init`).
    *   [ ] **Задача 9.5.2:** Создание и настройка базы данных.
    *   [ ] **Задача 9.5.3:** Настройка хранилища артефактов (MinIO).

*   [ ] **Задача 9.6:** Подготовить инструкции для использования в режиме совместного использования ключей:
    *   [ ] **Задача 9.6.1:** Регистрация в сети для владельцев ключей.
    *   [ ] **Задача 9.6.2:** Оформление подписки для пользователей.
    *   [ ] **Задача 9.6.3:** Настройка выплат для владельцев ключей.

## Модуль 10: Обучающие материалы и шаблоны

**Цель:** Обеспечить пользователей учебными материалами и шаблонами для работы с системой.

*   [ ] **Задача 10.1:** Разработать набор учебных материалов:
    *   [ ] **Задача 10.1.1:** Руководство по началу работы с Ricochet Task.
    *   [ ] **Задача 10.1.2:** Учебник по созданию эффективных цепочек моделей.
    *   [ ] **Задача 10.1.3:** Примеры использования для типичных сценариев.
    *   [ ] **Задача 10.1.4:** Видеоуроки по основным функциям.
*   [ ] **Задача 10.2:** Создать библиотеку шаблонов:
    *   [ ] **Задача 10.2.1:** Шаблоны для анализа больших документов.
    *   [ ] **Задача 10.2.2:** Шаблоны для работы с кодовыми базами.
    *   [ ] **Задача 10.2.3:** Шаблоны для обработки научных статей.
    *   [ ] **Задача 10.2.4:** Шаблоны для генерации контента.
*   [ ] **Задача 10.3:** Создать документацию по интеграции с Task Master:
    *   [ ] **Задача 10.3.1:** Руководство по совместному использованию с Task Master.
    *   [ ] **Задача 10.3.2:** Примеры рабочих процессов с использованием обоих инструментов.
    *   [ ] **Задача 10.3.3:** Конвертация проектов между Task Master и Ricochet Task.
*   [ ] **Задача 10.4:** Разработать интерактивные демо-сценарии:
    *   [ ] **Задача 10.4.1:** Демонстрация обработки большого документа.
    *   [ ] **Задача 10.4.2:** Демонстрация интеграции с редакторами кода.
    *   [ ] **Задача 10.4.3:** Демонстрация совместного использования API-ключей. 

## Этапы разработки MVP

### Этап 1: Основа системы (2 недели) - ЗАВЕРШЕН
*   Настройка проекта и окружения (Модуль 1)
*   Базовое ядро оркестратора (часть Модуля 2)
*   Простая интеграция с одной моделью, например OpenAI (часть Модуля 3)

### Этап 2: Базовая функциональность (2 недели) - ВЫПОЛНЕНО НА 80%
*   Завершение ядра оркестратора (Модуль 2)
*   Расширение интеграции с моделями (Модуль 3)
*   Базовый CLI-клиент (часть Модуля 4)

### Этап 3: Расширенная функциональность (2 недели) - В ПРОЦЕССЕ
*   Полный CLI-клиент (Модуль 4)
*   База данных и хранение (Модуль 6)
*   Базовая безопасность (часть Модуля 7)

### Этап 4: Интеграция и финализация (2 недели) - НЕ НАЧАТ
*   Интеграция с MCP (Модуль 5)
*   Завершение безопасности и администрирования (Модуль 7)
*   Тестирование и документация (Модуль 8)
*   Требования к установке и запуску (Модуль 9) 