#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ MCP —Å–µ—Ä–≤–µ—Ä–∞ Ricochet

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ MCP —Å–µ—Ä–≤–µ—Ä–∞ Ricochet..."

# –ü–æ–∏—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ MCP —Å–µ—Ä–≤–µ—Ä–∞
MCP_PID=$(ps aux | grep "ricochet-task mcp" | grep -v grep | awk '{print $2}')

if [ -z "$MCP_PID" ]; then
    echo "‚ö†Ô∏è MCP —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    exit 0
fi

echo "–ù–∞–π–¥–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å MCP —Å–µ—Ä–≤–µ—Ä–∞ —Å PID: $MCP_PID"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
kill $MCP_PID

# –û–∂–∏–¥–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
sleep 2

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
if ps -p $MCP_PID > /dev/null 2>&1; then
    echo "‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
    kill -9 $MCP_PID
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
if ! curl -s http://localhost:8091/tools > /dev/null 2>&1; then
    echo "‚úÖ MCP —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MCP —Å–µ—Ä–≤–µ—Ä"
    exit 1
fi
